{"ast":null,"code":"import _regeneratorRuntime from\"E:/TestDeploy/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/TestDeploy/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:/TestDeploy/front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{useEffect,useState,useRef}from'react';import{useFetchAllcode}from'../../customize/fetch';import{listRoomOfAdmin}from'../../../services/userService';import moment from'moment';import{toast}from'react-toastify';import{BrowserRouter as Router,Switch,Route,Link,Redirect}from\"react-router-dom\";import MessageDisscution from'../../Message/MessageDisscution';import ChatWindow from'../../Message/ChatWindow';import socketIOClient from\"socket.io-client\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";require('dotenv').config();var Message=function Message(){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),dataUser=_useState2[0],setdataUser=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dataRoom=_useState4[0],setdataRoom=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),selectedRoom=_useState6[0],setselectedRoom=_useState6[1];var host=process.env.REACT_APP_BACKEND_URL;var socketRef=useRef();var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),id=_useState8[0],setId=_useState8[1];useEffect(function(){socketRef.current=socketIOClient.connect(host);var userData=JSON.parse(localStorage.getItem('userData'));setdataUser(userData);socketRef.current.on('getId',function(data){setId(data);});// phần này đơn giản để gán id cho mỗi phiên kết nối vào page. Mục đích chính là để phân biệt đoạn nào là của mình đang chat.\nfetchListRoom();socketRef.current.on('sendDataServer',function(dataGot){fetchListRoom();});socketRef.current.on('loadRoomServer',function(dataGot){fetchListRoom(userData.id);});return function(){socketRef.current.disconnect();};},[]);var handleClickRoom=function handleClickRoom(roomId){socketRef.current.emit('loadRoomClient');setselectedRoom(roomId);};var fetchListRoom=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return listRoomOfAdmin();case 2:res=_context.sent;if(res&&res.errCode==0){setdataRoom(res.data);}case 4:case\"end\":return _context.stop();}}},_callee);}));return function fetchListRoom(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"ks-page-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"ks-page-content-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ks-messenger\",children:[/*#__PURE__*/_jsx(MessageDisscution,{userId:dataUser.id,isAdmin:true,handleClickRoom:handleClickRoom,data:dataRoom}),selectedRoom?/*#__PURE__*/_jsx(ChatWindow,{userId:dataUser.id,roomId:selectedRoom}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"title\",children:\"Ch\\u01B0a ch\\u1ECDn ph\\xF2ng\"})})]})})})});};export default Message;","map":{"version":3,"names":["React","useEffect","useState","useRef","useFetchAllcode","listRoomOfAdmin","moment","toast","BrowserRouter","Router","Switch","Route","Link","Redirect","MessageDisscution","ChatWindow","socketIOClient","require","config","Message","dataUser","setdataUser","dataRoom","setdataRoom","selectedRoom","setselectedRoom","host","process","env","REACT_APP_BACKEND_URL","socketRef","id","setId","current","connect","userData","JSON","parse","localStorage","getItem","on","data","fetchListRoom","dataGot","disconnect","handleClickRoom","roomId","emit","res","errCode"],"sources":["E:/TestDeploy/front-end/src/container/System/Message/Message.js"],"sourcesContent":["import React from 'react';\r\nimport { useEffect, useState ,useRef} from 'react';\r\nimport { useFetchAllcode } from '../../customize/fetch';\r\nimport {  listRoomOfAdmin} from '../../../services/userService';\r\nimport moment from 'moment';\r\nimport { toast } from 'react-toastify';\r\n\r\nimport {\r\n    BrowserRouter as Router,\r\n    Switch,\r\n    Route,\r\n    Link,\r\n    Redirect\r\n} from \"react-router-dom\";\r\nimport MessageDisscution from '../../Message/MessageDisscution';\r\nimport ChatWindow from '../../Message/ChatWindow';\r\nimport socketIOClient from \"socket.io-client\";\r\nrequire('dotenv').config();\r\nconst Message = () => {\r\n  const [dataUser, setdataUser] = useState({})\r\n    const [dataRoom, setdataRoom] = useState([])\r\n  const [selectedRoom, setselectedRoom] = useState('')\r\n  const host = process.env.REACT_APP_BACKEND_URL;\r\n  const socketRef = useRef();\r\n  const [id, setId] = useState();\r\n  useEffect(()=>{\r\n    socketRef.current = socketIOClient.connect(host)\r\n    const userData = JSON.parse(localStorage.getItem('userData'));\r\n    setdataUser(userData)\r\n    socketRef.current.on('getId', data => {\r\n      setId(data)\r\n    }) // phần này đơn giản để gán id cho mỗi phiên kết nối vào page. Mục đích chính là để phân biệt đoạn nào là của mình đang chat.\r\n    fetchListRoom()\r\n    socketRef.current.on('sendDataServer', dataGot => {\r\n      fetchListRoom()\r\n      }) \r\n      socketRef.current.on('loadRoomServer', dataGot => {\r\n        fetchListRoom(userData.id)\r\n        })  \r\n      return () => {\r\n        socketRef.current.disconnect();\r\n      };\r\n  },[])\r\n let handleClickRoom = (roomId)=>{\r\n    socketRef.current.emit('loadRoomClient')\r\n    setselectedRoom(roomId)\r\n   \r\n }\r\n let fetchListRoom = async() =>{\r\n  let res = await listRoomOfAdmin()\r\n  if(res && res.errCode==0){\r\n    setdataRoom(res.data)\r\n  }\r\n}\r\n    return (\r\n        <div className=\"container\">\r\n        <div className=\"ks-page-content\">\r\n          <div className=\"ks-page-content-body\">\r\n            <div className=\"ks-messenger\">\r\n                 <MessageDisscution userId={dataUser.id} isAdmin={true} handleClickRoom={handleClickRoom} data={dataRoom}/>\r\n                 {selectedRoom ? <ChatWindow userId={dataUser.id} roomId={selectedRoom}  />\r\n                 :<div>\r\n                    <span className='title'>Chưa chọn phòng</span>\r\n                 </div> \r\n                }\r\n                \r\n             \r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n}\r\nexport default Message;"],"mappings":"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"},"metadata":{},"sourceType":"module"}